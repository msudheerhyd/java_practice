<html>
    <head>
        <title>Radu's Avatar</title>
        <style>
            canvas{
                border: 1px solid black;
            }
            body{
                margin:0;
            }
            #sliders{
                position:absolute;
                top:0;
                left:310; 
            }
        </style>
    </head>
    <body>
        <canvas id="myCanvas"></canvas>
        <div id="sliders">
            x: <input type="range" min="-0.5" max="0.5" step="0.1" onChange="updatePoints(this,'x')"/>
            <br>
            y: <input type="range" min="-0.5" max="0.5" step="0.1" onChange="updatePoints(this,'y')"/>
        </div>
        <script>
            const canvas=document.getElementById("myCanvas");
            canvas.width=300;
            canvas.height=300;

            const ctx=canvas.getContext("2d");

            ctx.lineWidth=0.01;
            ctx.translate(canvas.width/2,canvas.height/2);
            ctx.scale(canvas.width*0.5,canvas.height*0.5);
            const img=new Image();
            img.src="portrait1.png";

            const livePoints={
                A:{x:0,y:-0.13,xRange:[0,0.2],yRange:[-0.13,0.1],xOffset:0,yOffset:0},
                B:{x:0,y:-0.77,xRange:[0,0.02],yRange:[-0.77,-0.73],xOffset:0,yOffset:0},
                C:{x:0,y:0.46,xRange:[0,0.2],yRange:[0.46,0.48],yNegRange:[0.46,0.30],xOffset:0,yOffset:0}
                
            }
            const {A,B,C}=livePoints;


            img.onload=function(){
                animate();
            }

            canvas.addEventListener("click", getCoords);

            function animate(){
                ctx.clearRect(-1,-1,2,2);
                ctx.globalAlpha=0.2;
                ctx.drawImage(img,-1,-1,2,2);
                ctx.globalAlpha=1;

                drawMe();
                requestAnimationFrame(animate);
            }

            function getCoords(evt){
                const x=(evt.x-canvas.width/2)/(canvas.width/2);
                const y=(evt.y-canvas.height/2)/(canvas.height/2);
                const offset={
                    x:x-A.x,
                    y:y-A.y
                }
                console.log(offset.x.toFixed(2)+","+offset.y.toFixed(2)); 
            }


            function drawMe(){
                drawBody();
                drawHead();

                drawPoint(A,"A");
                drawPoint(B,"B");
                drawPoint(C,"C");
            }

            function drawHead(){
                ctx.strokeStyle="gray";
                ctx.beginPath();
                ctx.moveTo(B.x,B.y);
                ctx.quadraticCurveTo(A.x,A.y,C.x,C.y);
                ctx.moveTo(-0.5,-0.13);
                ctx.quadraticCurveTo(A.x,A.y,0.5,-0.13);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(B.x,B.y);
                ctx.quadraticCurveTo(-0.44,-0.71,-0.5,-0.13);
                ctx.quadraticCurveTo(-0.37,0.28,C.x,C.y);
                ctx.quadraticCurveTo(0.37,0.28,0.5,-0.13);
                ctx.quadraticCurveTo(0.44,-0.71,B.x,B.y);
                ctx.stroke();

                ctx.strokeStyle="black";

                drawEyes(A);

                drawBeard(A);
            }

            function drawBeard(ref){
                ctx.save();
                ctx.translate(ref.x,ref.y);

                drawHalfBeard(
                    Math.max(0,ref.xOffset),
                    ref.yOffset,
                    Math.min(0,ref.yOffset),
                    Math.min(0,ref.xOffset));
                
                ctx.scale(-1,1);

                drawHalfBeard(
                    Math.max(0,-ref.xOffset),
                    ref.yOffset,
                    Math.min(0,ref.yOffset),
                    Math.min(0,-ref.xOffset));
                


                ctx.restore();
            }

            function drawHalfBeard(scaleX,scaleY,verticalScaler,horizontalScaler){
                ctx.save(); 
                const horizontalSquish=1-scaleX*0.45
                const verticalSquish=1-Math.abs(scaleY*0.2)
                ctx.scale(horizontalSquish,verticalSquish);


                ctx.beginPath();
                ctx.moveTo(0.41,0.09);
                ctx.quadraticCurveTo(0.35,0.28,0.17,0.36);
                ctx.quadraticCurveTo(0.09,0.33,0,0.35);


                ctx.lineTo(0.01,0.38);
                ctx.lineTo(0.11,0.42);
                ctx.lineTo(0.06,0.49);
                ctx.lineTo(0.04,0.46);
                ctx.lineTo(0.01,0.46);
                

                const bottomMostPoint={
                    x:0,
                    y:0.59-verticalScaler*0.2,
                }
                ctx.lineTo(bottomMostPoint.x,bottomMostPoint.y);
                
                const rightMostPoint={
                    x:0.44-horizontalScaler*0.2,
                    y:0.09,
                }

                const controlPoint={
                    x:0.35-horizontalScaler*0.2,
                    y:0.46-verticalScaler*0.2,
                }

               

                ctx.quadraticCurveTo(
                    controlPoint.x,controlPoint.y,
                    rightMostPoint.x,rightMostPoint.y);
                ctx.closePath();

                ctx.restore();
                ctx.stroke();
            }

            function drawEyes(ref){
                ctx.save();
                ctx.translate(ref.x,ref.y);

                drawEye(Math.max(0,ref.xOffset),ref.yOffset);

                ctx.scale(-1,1);
                drawEye(Math.max(0,-ref.xOffset),ref.yOffset);
                
                ctx.restore();
            }

            function drawEye(scaleX,scaleY){
                ctx.save();  
                const verticalSquish=1-Math.abs(scaleY*0.2)
                const horizontalSquish=1-scaleX*0.4
                ctx.scale(horizontalSquish,verticalSquish);
                ctx.beginPath();
                ctx.moveTo(0.05,0.11);
                ctx.quadraticCurveTo(0.06,0.18,0.20,0.19);
                ctx.quadraticCurveTo(0.35,0.18,0.35,0.06);
                ctx.quadraticCurveTo(0.35,0.02,0.19,0.02);
                ctx.quadraticCurveTo(0.05,0.01,0.05,0.11);
                ctx.fillStyle="white";
                ctx.fill();

                

                ctx.beginPath();
                ctx.fillStyle="black";
                ctx.moveTo(0.07,0.07);
                ctx.quadraticCurveTo(0.21,-0.01,0.33,0.08);
                ctx.quadraticCurveTo(0.39,0.10,0.36,0.04);
                ctx.quadraticCurveTo(0.19,-0.06,0.03,0.04);
                ctx.quadraticCurveTo(0.02,0.09,0.07,0.07);
                ctx.fill();

                ctx.beginPath();
                ctx.arc(0.17,0.09,0.065,0,Math.PI*2);
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(0.20,0.19);
                ctx.quadraticCurveTo(0.35,0.18,0.35,0.06);
                ctx.restore();
                ctx.stroke();

                
                
            }
            // not used
            function drawGlassEye(){
                ctx.beginPath();
                ctx.moveTo(0.05,0.11);
                ctx.quadraticCurveTo(0.06,0.18,0.20,0.19);
                ctx.quadraticCurveTo(0.35,0.18,0.35,0.06);
                ctx.quadraticCurveTo(0.35,0.02,0.19,0.02);
                ctx.quadraticCurveTo(0.05,0.01,0.05,0.11);
                ctx.stroke();

            }

            function drawBody(){
                ctx.strokeStyle="gray";

                ctx.beginPath();
                ctx.moveTo(-0.25,0.21);
                ctx.quadraticCurveTo(-0.21,0.41,-0.23,0.61);
                ctx.lineTo(-0.89,0.85);
                ctx.lineTo(-0.89,1.1);
                ctx.lineTo(+0.89,1.1);
                ctx.lineTo(+0.89,0.85);
                ctx.lineTo(+0.23,0.61);
                ctx.quadraticCurveTo(+0.21,0.41,+0.25,0.21);
                ctx.stroke();
                ctx.strokeStyle="black";

            }

            function drawPoint(loc,label,rad=0.07){
                ctx.beginPath();
                ctx.arc(loc.x,loc.y,rad,0,Math.PI*2);
                ctx.fillStyle="green";
                ctx.fill();  
                ctx.fillStyle="white";
                ctx.font=(rad*1.6)+"px Arial";
                ctx.textAlign="center";
                ctx.textBaseline="middle";          
                ctx.fillText(label,loc.x,loc.y+rad*0.15);
            }

            function updatePoints(info,attr){
                for(let pId in livePoints){
                    const p=livePoints[pId];
                    let yRange=p.yRange;
                    let value=info.value;
                    if(p.yNegRange){
                        yRange=info.value<0?p.yNegRange:p.yRange;
                        value=Math.abs(value);
                    }
                    switch(attr){
                        case "x":
                            p.xOffset=value;
                            p.x=lerp(p.xRange[0],p.xRange[1],info.value);
                            break;
                        case "y":
                        p.yOffset=value;
                            p.y=lerp(yRange[0],yRange[1],value);  
                            break; 
                    }     
                }
            }

            function lerp(s,e,t){
                return s+(e-s)*t;
            }

        </script>
    </body>
</html>